<!DOCTYPE HTML>
<style>
  .lolcursor {
    cursor: url('assets/wii.cur'), auto;
  }
</style>
<div class="lolcursor">
  <html>

  <head>
    <style>
      p {
        font-size: 20px;
        color: blue;
        animation: fadeIn 1s ease-in-out;
      }
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
    </style>
    <p>Snake v7.0</p>
    <meta charset="UTF-8">
    <title>Snake v7.0</title>
    <link rel="icon" href="snake/favicon/snake.ico" type="image/ico">
    <style>
      @import url("https://fonts.googleapis.com/css?family=VT323");

::selection {
  color: #FFFFFF;
  background: transparent;
}

::-moz-selection {
  color: #FFFFFF;
  background: transparent;
}

* {
  margin: 0;
  padding: 0;
  font-family: "VT323";
}

a {
  text-decoration: line;
  font-size: 20pt;
  text-align: center;
  margin-left: auto;
  margin-right: auto;
}

k {
  font-size: 20px;
  color: red;
  margin-bottom: auto;
  animation: pulse 2s infinite;
}
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); }
}

div.a {
  color: #000000;
  text-align: center;
  font-size: 40px;
  animation: colorChange 5s infinite;
}
@keyframes colorChange {
  0% { color: #000000; }
  25% { color: #FF0000; }
  50% { color: #00FF00; }
  75% { color: #0000FF; }
  100% { color: #000000; }
}

body {
  background-color: #000000;
}

.wrap {
  margin-left: auto;
  margin-right: auto;
}
text {
  height: 20px;
  position: center;
}

#help h1 {
  width: 340px;
  position: center;
  margin-left: auto;
  margin-right: auto;
  font-family: "VT323";
  color: #FFFFFF;
  animation: slideInFromLeft 1s ease-out, glowText 2s infinite alternate;
}
@keyframes slideInFromLeft {
  from { transform: translateX(-100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}
@keyframes glowText {
  from { text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px #fff; }
  to { text-shadow: 0 0 10px #fff, 0 0 20px #fff, 0 0 30px #fff; }
}

header {
  width: 340px;
  font-size: 0;
  position: center;
}

canvas {
  display: none;
  border-style: solid;
  border-width: 10px;
  border-color: #FFFFFF;
}

canvas:focus {
  outline: none;
}

/* Top Styles */
h1 {
  display: block;
  width: 100px;
  font-size: 32px;
  color: #FFFFFF;
  animation: logo-ani 2s ease-in-out infinite;
  margin-bottom: 30px;
}

.score {
  display: inline-block;
  width: 240px;
  font-size: 25px;
  text-align: right;
  color: #FFFFFF;
}

.score_value {
  font-size: inherit;
}

/* All screens style */
#gameover a,
#setting a,
#menu a {
  display: block;
}

#gameover a,
#setting a:hover,
#menu a:hover {
  cursor: pointer;
}

#gameover a:hover::before,
#setting a:hover::before,
#menu a:hover::before {
  content: "-->";
  margin-right: 10px;
  animation: arrowBounce 0.5s infinite alternate;
}
@keyframes arrowBounce {
  from { transform: translateX(0) scale(1); }
  to { transform: translateX(5px) scale(1.2); }
}

/* Menu Screen Style */
#menu {
  display: block;
  width: 340px;
  padding-top: 95px;
  padding-bottom: 95px;
  font-size: 40px;
  margin-left: auto;
  margin-right: auto;
  text-align: center;
  color: orange;
  animation: fadeIn 1s ease-in-out;
}

#menu h2 {
  animation: logo-ani 2s ease-in-out infinite;
  margin-bottom: 30px;
}

#menu a {
  font-size: 30px;
  transition: all 0.3s ease;
}
#menu a:hover {
  color: #FFFFFF;
  transform: scale(1.1) rotate(5deg);
}

@keyframes logo-ani {
  0% { transform: scale(1) rotate(0deg); }
  50% { transform: scale(1.3) rotate(5deg); }
  100% { transform: scale(1) rotate(0deg); }
}

/* Game Over Screen Style */
#gameover {
  display: none;
  width: 340px;
  padding-top: 95px;
  padding-bottom: 95px;
  margin-left: auto;
  margin-right: auto;
  text-align: center;
  font-size: 30px;
  color: blue;
  animation: fadeIn 1s ease-in-out, shake 0.5s ease-in-out 1s;
}
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
  20%, 40%, 60%, 80% { transform: translateX(10px); }
}

li {
  display: inline-block;
  white-space: 5px;
}

#gameover h2 {
  text-align: center;
  margin-left: auto;
  margin-right: auto;
  margin-bottom: 50px;
  cursor: help;
  color: blue;
  animation: slidein 2s ease-in-out, pulse 2s infinite;
}

@keyframes slidein {
  from {
    margin-left: 100%;
    width: 300%;
  }
  to {
    margin-left: 0%;
    width: 100%;
  }
}

#gameover p {
  margin-top: 75px;
  font-size: 20px;
  animation: fadeIn 2s ease-in-out, typewriter 3s steps(40, end);
}
@keyframes typewriter {
  from { width: 0; }
  to { width: 100%; }
}

/* Settings Screen Style */
#setting {
  display: none;
  width: 340px;
  margin-left: auto;
  margin-right: auto;
  padding-top: 85px;
  padding-bottom: 85px;
  font-size: 30px;
  color: red;
  text-align: center;
  animation: fadeIn 1s ease-in-out;
  background-color: #000000;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
}

#setting h2 {
  margin-bottom: 15px;
  text-align: center;
  margin-left: auto;
  margin-right: auto;
  margin-bottom: 30px;
  cursor: pointer;
  color: red;
  animation: glow 2s ease-in-out infinite alternate;
}
@keyframes glow {
  from { text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px #fff, 0 0 20px #ff00de, 0 0 35px #ff00de, 0 0 40px #ff00de, 0 0 50px #ff00de, 0 0 75px #ff00de; }
  to { text-shadow: 0 0 10px #fff, 0 0 20px #fff, 0 0 30px #fff, 0 0 40px #ff00de, 0 0 70px #ff00de, 0 0 80px #ff00de, 0 0 100px #ff00de, 0 0 150px #ff00de; }
}

#setting p {
  margin-top: 10px;
  font-size: 30px;
}

#setting input {
  display: none;
  content: '-->';
}

#setting label {
  cursor: pointer;
  display: block;
  padding: 10px;
  margin: 5px 0;
  background-color: #333;
  color: #fff;
  border-radius: 5px;
  transition: background-color 0.3s ease;
}

#setting label:hover {
  background-color: #555;
}

#setting input:checked+label {
  background-color: #000fff;
  color: #FFFFFF;
  animation: pulse 0.5s;
}

highlight {
  size: 40px;
  color: blue;
  animation: colorChange 5s infinite;
}
@keyframes colorChange {
  0% { color: blue; }
  33% { color: red; }
  66% { color: green; }
  100% { color: blue; }
}

ul {
  display: inline-block;
  text-align: left;
  padding: 0;
  list-style: none;
}
b {
  font-size: 75px;
  animation: color-change 10s infinite, bounce 2s ease infinite, rotateText 4s linear infinite;
}

@keyframes color-change {
  0% { color: red; }
  33% { color: green; }
  66% { color: blue; }
  100% { color: red; }
}

@keyframes bounce {
  0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
  40% { transform: translateY(-30px); }
  60% { transform: translateY(-15px); }
}

@keyframes rotateText {
  0% { transform: rotateY(0deg); }
  100% { transform: rotateY(360deg); }
}

#controls {
  position: fixed;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  width: 150px;
  z-index: 1000;
  display: none; /* Hide controls by default */
}

#controls button {
  width: 60px;
  height: 60px;
  margin: 3px;
  border: none;
  background-color: transparent;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
}

#up { background-image: url('mobilebuttons/up.png'); }
#down { background-image: url('mobilebuttons/down.png'); }
#left { background-image: url('mobilebuttons/left.png'); }
#right { background-image: url('mobilebuttons/right.png'); }

#up, #down {
  display: block;
  margin: 3px auto;
}

#left, #right {
  display: inline-block;
}

#left {
  margin-right: 20px;
}
    </style>
    <br />
    <header class="wrap">
      <p class="score">Apples Eaten: <span id="score_value">0</span></p>
    </header>
    <canvas class="wrap" id="snake" width="420" height="420" tabindex="1"></canvas>

    <!-- Add on-screen controls -->
    <div id="controls">
      <button id="up">↑</button>
      <div>
        <button id="left">←</button>
        <button id="right">→</button>
      </div>
      <button id="down">↓</button>
    </div>

    <!-- Game Over Screen -->
    <div id="gameover">
      <h2>Game Over</h2>
      <p>press <span style="background-color: #000fff; color: #000000; animation: flash 1s infinite;">the 'enter' key</span> to begin a new game</p>
      <a id="newgame_gameover">new game</a>
      <a id="setting_gameover">settings</a>
    </div>
    <!-- Setting screen -->
    <div id="setting">
      <h2 class="a">Settings</h2>
      <a id="newgame_setting">new game</a>
      <ul>
        <p type="list">Speed:
          <li>
            <input id="speedSLOW" type="radio" name="speed" value="100" />
            <label for="speedSLOW">super slow.</label>
            <input id="speed2" type="radio" name="speed" value="60" />
            <label for="speed2">Slow</label>
            <input id="speed3" type="radio" name="speed" value="45" checked />
            <label for="speed3">Normal</label>
            <input id="speed4" type="radio" name="speed" value="30" />
            <label for="speed4">Fast</label>
          </li>
        <p>Wall:
          <li><input id="wallon" type="radio" name="wall" value="1" checked />
            <label for="wallon">on</label>
            <input id="walloff" type="radio" name="wall" value="0" />
            <label for="walloff">off</label>
          </li>
      </ul>
    </div>
    <!-- Main Menu Screen -->
    <div id="menu">
      <b>Snake</b>
      <style>
        .buttoncolor {
          background-color: black;
          border: none;
          color: red;
          text-align: center;
          font-size: 20px;
          transition: all 0.3s ease;
        }
        .buttoncolor:hover {
          transform: scale(1.1);
          color: #FFFFFF;
        }
      </style>
      <a id="newgame_menu">Play</a>
      <a id="setting_menu">Settings</a>
      <script>
        function onClick() {
          alert("Use W A S D, arrow keys, or if you have a device with a touch screen.")
        }
      </script>
      <button class="buttoncolor" align="bottom" onclick="onClick()">Controls (click me!)</button>
    </div>
<script>
  (function () {
  /////////////////////////////////////////////////////////////

  // Canvas & Context

  var canvas;
  var ctx;

  // Snake

  var snake;
  var apple;
  var snake_dir;
  var snake_next_dir;
  var snake_speed;
  var $;
  var input;

  // Food

  var food = {
    x: 0,
    y: 0
  };

  // Score

  var score;

  // Wall

  var wall;

  // HTML Elements

  var screen_snake;
  var screen_menu;
  var screen_setting;
  var screen_gameover;
  var button_newgame_menu;
  var button_newgame_setting;
  var button_newgame_gameover;
  var button_setting_menu;
  var button_setting_gameover;
  var ele_score;
  var speed_setting;
  var wall_setting;
  var activeDot;

  // Gamepad

  var gamepad;

  /////////////////////////////////////////////////////////////

  var activeDot = function (x, y) {
    ctx.fillStyle = "#00FF00";
    ctx.fillRect(x * 10, y * 10, 10, 10);
  };
  /////////////////////////////////////////////////////////////

  var changeDir = function (key) {
    if (key == 87 && snake_dir != 2) {
      snake_next_dir = 0;
    } else {
      if (key == 68 && snake_dir != 3) {
        snake_next_dir = 1;
      } else {
        if (key == 83 && snake_dir != 0) {
          snake_next_dir = 2;
        } else {
          if (key == 65 && snake_dir != 1) {
            snake_next_dir = 3;
          }
        }
      }
    }
    if (key == 38 && snake_dir != 2) {
      snake_next_dir = 0;
    } else {
      if (key == 39 && snake_dir != 3) {
        snake_next_dir = 1;
      } else {
        if (key == 40 && snake_dir != 0) {
          snake_next_dir = 2;
        } else {
          if (key == 37 && snake_dir != 1) {
            snake_next_dir = 3;
          }
        }
      }
    }
  };

  /////////////////////////////////////////////////////////////

  var addFood = function () {
    food.x = Math.floor(Math.random() * ((canvas.width / 10) - 1));
    food.y = Math.floor(Math.random() * ((canvas.height / 10) - 1));
    for (var i = 0; i < snake.length; i++) {
      if (checkBlock(food.x, food.y, snake[i].x, snake[i].y)) {
        addFood(1);
      }
    }
  };

  /////////////////////////////////////////////////////////////

  var checkBlock = function (x, y, _x, _y) {
    return (x == _x && y == _y) ? true : false;
  };

  /////////////////////////////////////////////////////////////

  var altScore = function (score_val) {
    ele_score.innerHTML = String(score_val);
  };

  /////////////////////////////////////////////////////////////

  var mainLoop = function () {
    var _x = snake[0].x;
    var _y = snake[0].y;
    snake_dir = snake_next_dir;

    // 0 - Up, 1 - Right, 2 - Down, 3 - Left
    switch (snake_dir) {
      case 0:
        _y--;
        break;
      case 1:
        _x++;
        break;
      case 2:
        _y++;
        break;
      case 3:
        _x--;
        break;
    }

    snake.pop();
    snake.unshift({
      x: _x,
      y: _y
    });

    // --------------------

    // Wall

    if (wall == 1) {
      // On
      if (snake[0].x < 0 || snake[0].x == canvas.width / 10 || snake[0].y < 0 || snake[0].y == canvas.height / 10) {
        showScreen(3);
        return;
      }
    } else {
      // Off
      for (var i = 0, x = snake.length; i < x; i++) {
        if (snake[i].x < 0) {
          snake[i].x = snake[i].x + (canvas.width / 10);
        }
        if (snake[i].x == canvas.width / 10) {
          snake[i].x = snake[i].x - (canvas.width / 10);
        }
        if (snake[i].y < 0) {
          snake[i].y = snake[i].y + (canvas.height / 10);
        }
        if (snake[i].y == canvas.height / 10) {
          snake[i].y = snake[i].y - (canvas.height / 10);
        }
      }
    }

    // --------------------

    // Autophagy death
    for (var i = 1; i < snake.length; i++) {
      if (snake[0].x == snake[i].x && snake[0].y == snake[i].y) {
      }
    }

    // --------------------

    // Eat Food
    if (checkBlock(snake[0].x, snake[0].y, food.x, food.y)) {
      snake[snake.length] = {
        x: snake[0].x,
        y: snake[0].y
      };
      score += 1;
      altScore(score);
      addFood();
      activeDot(food.x, food.y);
    }

    // --------------------

    ctx.beginPath();
    ctx.fillStyle = "#000000";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // --------------------

    for (var i = 0; i < snake.length; i++) {
      activeDot(snake[i].x, snake[i].y);
    }

    // --------------------

    activeDot(food.x, food.y);

    // Debug
    // document.getElementById("debug").innerHTML = snake_dir + " " + snake_next_dir + " " + snake[0].x + " " + snake[0].y;

    // Check for gamepad input
    checkGamepadInput();

    setTimeout(mainLoop, snake_speed);
  };

  /////////////////////////////////////////////////////////////

  var newGame = function () {
    showScreen(0);
    screen_snake.focus();

    snake = [];
    for (var i = 4; i >= 0; i--) {
      snake.push({
        x: i,
        y: 15
      });
    }

    snake_next_dir = 1;

    score = 0;
    altScore(score);

    addFood();

    canvas.onkeydown = function (evt) {
      evt = evt || window.event;
      changeDir(evt.keyCode);
    };
    mainLoop();
  };

  /////////////////////////////////////////////////////////////

  // Change the snake speed...
  // 100 = super slow
  // 60 = slow
  // 45 = normal
  // 30 = fast
  var setSnakeSpeed = function (speed_value) {
    snake_speed = speed_value;
  };

  /////////////////////////////////////////////////////////////
  var setWall = function (wall_value) {
    wall = wall_value;
    if (wall == 0) {
      screen_snake.style.borderColor = "#606060";
    }
    if (wall == 1) {
      screen_snake.style.borderColor = "#C0C0C0";
    }
    if (wall == 2) {
      screen_snake.style.borderColor = "#000000";
    }
  };
  /////////////////////////////////////////////////////////////

  // 0 for the game
  // 1 for the main menu
  // 2 for the settings screen
  // 3 for the game over screen
  var showScreen = function (screen_opt) {
    switch (screen_opt) {
      case 0:
        screen_snake.style.display = "block";
        screen_menu.style.display = "none";
        screen_setting.style.display = "none";
        screen_gameover.style.display = "none";
        document.getElementById("controls").style.display = "block"; // Show controls
        break;
      case 1:
        screen_snake.style.display = "none";
        screen_menu.style.display = "block";
        screen_setting.style.display = "none";
        screen_gameover.style.display = "none";
        document.getElementById("controls").style.display = "none"; // Hide controls
        break;
      case 2:
        screen_snake.style.display = "none";
        screen_menu.style.display = "none";
        screen_setting.style.display = "block";
        screen_gameover.style.display = "none";
        break;
      case 3:
        screen_snake.style.display = "none";
        screen_menu.style.display = "none";
        screen_setting.style.display = "none";
        screen_gameover.style.display = "block";
        break;
    }
  };

  /////////////////////////////////////////////////////////////

  window.onload = function () {
    canvas = document.getElementById("snake");
    ctx = canvas.getContext("2d");

    // Screens
    screen_snake = document.getElementById("snake");
    screen_menu = document.getElementById("menu");
    screen_gameover = document.getElementById("gameover");
    screen_setting = document.getElementById("setting");

    // Buttons
    button_newgame_menu = document.getElementById("newgame_menu");
    button_newgame_setting = document.getElementById("newgame_setting");
    button_newgame_gameover = document.getElementById("newgame_gameover");
    button_setting_menu = document.getElementById("setting_menu");
    button_setting_gameover = document.getElementById("setting_gameover");

    // etc
    ele_score = document.getElementById("score_value");
    speed_setting = document.getElementsByName("speed");
    wall_setting = document.getElementsByName("wall");

    // --------------------

    button_newgame_menu.onclick = function () {
      newGame();
    };
    button_newgame_gameover.onclick = function () {
      newGame();
    };
    button_newgame_setting.onclick = function () {
      newGame();
    };
    button_setting_menu.onclick = function () {
      showScreen(2);
    };
    button_setting_gameover.onclick = function () {
      showScreen(2);
    };

    setSnakeSpeed(150);
    setWall(1);

    showScreen("snake");

    // --------------------
    // Settings

    // speed
    for (var i = 0; i < speed_setting.length; i++) {
      speed_setting[i].addEventListener("click", function () {
        for (var i = 0; i < speed_setting.length; i++) {
          if (speed_setting[i].checked) {
            setSnakeSpeed(speed_setting[i].value);
          }
        }
      });
    }

    // wall
    for (var i = 0; i < wall_setting.length; i++) {
      wall_setting[i].addEventListener("click", function () {
        for (var i = 0; i < wall_setting.length; i++) {
          if (wall_setting[i].checked) {
            setWall(wall_setting[i].value);
          }
        }
      });
    }

    for (var i = 2; i < wall_setting.length; i++) {
      wall_setting[i].addEventListener("click", function () {
        for (var i = 2; i < wall_setting.length; i++) {
          if (wall_setting[i].checked) {
            setWall(wall_setting[i].value);
          }
        }
      });
    }

    ///////////////////////////////////////////////////////////

    document.onkeydown = function (evt) {
      if (screen_gameover.style.display == "block") {
        evt = evt || window.event;
        if (event.keyCode == 13) {
          newGame();
        }
      }
    };

    // Initialize gamepad
    window.addEventListener("gamepadconnected", function(e) {
      console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",
        e.gamepad.index, e.gamepad.id,
        e.gamepad.buttons.length, e.gamepad.axes.length);
      gamepad = e.gamepad;
    });

    window.addEventListener("gamepaddisconnected", function(e) {
      console.log("Gamepad disconnected from index %d: %s",
        e.gamepad.index, e.gamepad.id);
      gamepad = null;
    });

    // Add event listeners for on-screen controls
    document.getElementById("up").addEventListener("click", function() { changeDir(87); });
    document.getElementById("down").addEventListener("click", function() { changeDir(83); });
    document.getElementById("left").addEventListener("click", function() { changeDir(65); });
    document.getElementById("right").addEventListener("click", function() { changeDir(68); });

    // Load snake head image
    var snakeHeadImg = new Image();
    snakeHeadImg.src = 'snakehead/snakehead.png'; // Adjust the path if needed

    var drawSnake = function () {
      for (var i = 1; i < snake.length; i++) {
        activeDot(snake[i].x, snake[i].y);
      }
      
      // Draw snake head
      var headX = snake[0].x * 10;
      var headY = snake[0].y * 10;
      ctx.save();
      ctx.translate(headX + 5, headY + 5);
      ctx.rotate((Math.PI / 2) * snake_dir);
      ctx.drawImage(snakeHeadImg, -5, -5, 10, 10);
      ctx.restore();
    };

    var mainLoop = function () {
      var _x = snake[0].x;
      var _y = snake[0].y;
      snake_dir = snake_next_dir;

      // 0 - Up, 1 - Right, 2 - Down, 3 - Left
      switch (snake_dir) {
        case 0:
          _y--;
          break;
        case 1:
          _x++;
          break;
        case 2:
          _y++;
          break;
        case 3:
          _x--;
          break;
      }

      snake.pop();
      snake.unshift({
        x: _x,
        y: _y
      });

      // --------------------

      // Wall

      if (wall == 1) {
        // On
        if (snake[0].x < 0 || snake[0].x == canvas.width / 10 || snake[0].y < 0 || snake[0].y == canvas.height / 10) {
          showScreen(3);
          return;
        }
      } else {
        // Off
        for (var i = 0, x = snake.length; i < x; i++) {
          if (snake[i].x < 0) {
            snake[i].x = snake[i].x + (canvas.width / 10);
          }
          if (snake[i].x == canvas.width / 10) {
            snake[i].x = snake[i].x - (canvas.width / 10);
          }
          if (snake[i].y < 0) {
            snake[i].y = snake[i].y + (canvas.height / 10);
          }
          if (snake[i].y == canvas.height / 10) {
            snake[i].y = snake[i].y - (canvas.height / 10);
          }
        }
      }

      // --------------------

      // Autophagy death
      for (var i = 1; i < snake.length; i++) {
        if (snake[0].x == snake[i].x && snake[0].y == snake[i].y) {
        }
      }

      // --------------------

      // Eat Food
      if (checkBlock(snake[0].x, snake[0].y, food.x, food.y)) {
        snake[snake.length] = {
          x: snake[0].x,
          y: snake[0].y
        };
        score += 1;
        altScore(score);
        addFood();
        activeDot(food.x, food.y);
      }

      // --------------------

      ctx.beginPath();
      ctx.fillStyle = "#000000";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // --------------------

      drawSnake();
      activeDot(food.x, food.y);

      // Debug
      // document.getElementById("debug").innerHTML = snake_dir + " " + snake_next_dir + " " + snake[0].x + " " + snake[0].y;

      // Check for gamepad input
      checkGamepadInput();

      setTimeout(mainLoop, snake_speed);
    };

    // Detect touch events
    canvas.addEventListener("touchstart", handleTouchStart, false);
    canvas.addEventListener("touchmove", handleTouchMove, false);
    canvas.addEventListener("touchend", handleTouchEnd, false);

    var touchStartX, touchStartY;
    var touchEndX, touchEndY;

    function handleTouchStart(event) {
      event.preventDefault();
      var rect = canvas.getBoundingClientRect();
      touchStartX = event.touches[0].clientX - rect.left;
      touchStartY = event.touches[0].clientY - rect.top;
    }

    function handleTouchMove(event) {
      event.preventDefault();
      if (!touchStartX || !touchStartY) {
        return;
      }

      var rect = canvas.getBoundingClientRect();
      touchEndX = event.touches[0].clientX - rect.left;
      touchEndY = event.touches[0].clientY - rect.top;

      handleSwipe();
    }

    function handleTouchEnd(event) {
      event.preventDefault();
      if (!touchStartX || !touchStartY) {
        return;
      }

      var rect = canvas.getBoundingClientRect();
      touchEndX = event.changedTouches[0].clientX - rect.left;
      touchEndY = event.changedTouches[0].clientY - rect.top;

      handleSwipe();

      touchStartX = null;
      touchStartY = null;
    }

    function handleSwipe() {
      var deltaX = touchEndX - touchStartX;
      var deltaY = touchEndY - touchStartY;

      if (Math.abs(deltaX) > Math.abs(deltaY)) {
        // Horizontal swipe
        if (deltaX > 0 && snake_dir !== 3) {
          snake_next_dir = 1; // Right
        } else if (deltaX < 0 && snake_dir !== 1) {
          snake_next_dir = 3; // Left
        }
      } else {
        // Vertical swipe
        if (deltaY > 0 && snake_dir !== 0) {
          snake_next_dir = 2; // Down
        } else if (deltaY < 0 && snake_dir !== 2) {
          snake_next_dir = 0; // Up
        }
      }
    }
  };

  // Function to check gamepad input
  function checkGamepadInput() {
    if (!gamepad) return;

    var gamepads = navigator.getGamepads ? navigator.getGamepads() : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads() : []);
    if (!gamepads) return;

    var gp = gamepads[gamepad.index];

    // Check d-pad
    if (gp.buttons[12].pressed && snake_dir != 2) { // Up
      snake_next_dir = 0;
    } else if (gp.buttons[13].pressed && snake_dir != 0) { // Down
      snake_next_dir = 2;
    } else if (gp.buttons[14].pressed && snake_dir != 1) { // Left
      snake_next_dir = 3;
    } else if (gp.buttons[15].pressed && snake_dir != 3) { // Right
      snake_next_dir = 1;
    }

    // Check analog sticks
    var axisThreshold = 0.5;
    if (gp.axes[1] < -axisThreshold && snake_dir != 2) { // Left stick up
      snake_next_dir = 0;
    } else if (gp.axes[1] > axisThreshold && snake_dir != 0) { // Left stick down
      snake_next_dir = 2;
    } else if (gp.axes[0] < -axisThreshold && snake_dir != 1) { // Left stick left
      snake_next_dir = 3;
    } else if (gp.axes[0] > axisThreshold && snake_dir != 3) { // Left stick right
      snake_next_dir = 1;
    }

    // Check buttons for new game (you can change this to any button you prefer)
    if (gp.buttons[9].pressed) { // Start button
      if (screen_gameover.style.display == "block") {
        newGame();
      }
    }
  }
})();
</script>